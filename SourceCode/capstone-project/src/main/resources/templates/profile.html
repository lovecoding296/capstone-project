<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title>Profile</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title th:text="#{logo}"></title>

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<!-- Bootstrap Bundle with Popper -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<link rel="stylesheet" href="styles.css">
	<script src="script.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
	<!-- Navigation Bar -->
	<nav th:replace="page-component :: header"></nav>

	<h2>Profile Information</h2>

	<div id="message"></div>

	<div th:if="${param.success}">
		<p style="color: green;">Profile updated successfully!</p>
	</div>

	<form id="profileForm" enctype="multipart/form-data">
		<div>
			<label>Name:</label>
			<input type="text" name="name" th:value="${user.name}">
		</div>
		<div>
			<label>City:</label>
			<input type="text" name="city" th:value="${user.city}">
		</div>
		<div>
			<label>Phone:</label>
			<input type="text" name="phone" th:value="${user.phone}">
		</div>
		<div>
			<label>Profile Picture:</label>
			<input type="file" name="profilePicture">
		</div>
		<div>
			<img th:if="${user.profilePicture}" th:src="@{${user.profilePicture}}" width="100" height="100">
		</div>
		<button type="submit">Update</button>
	</form>

	<br>
	<a href="/">Back to Home</a>
	
	<footer th:replace="~{page-component :: footer}"></footer>

	<script>
		$(document).ready(function () {
			// Fetch user data when the page loads
			$.get("/api/profile", function (user) {
				$("#name").val(user.name);
				$("#city").val(user.city);
				$("#phone").val(user.phone);
				if (user.profilePicture) {
					$("#profileImage").attr("src", user.profilePicture);
				}
			});

			$("#profileForm").submit(function (event) {
				event.preventDefault();

				var formData = new FormData(this);

				$.ajax({
					url: "/api/profile/update",
					type: "POST",
					data: formData,
					processData: false,
					contentType: false,
					success: function (response) {
						$("#message").html("<p style='color: green;'>" + response + "</p>");
					},
					error: function () {
						$("#message").html("<p style='color: red;'>Error updating profile.</p>");
					}
				});
			});
		});
	</script>
	
</body>

</html>