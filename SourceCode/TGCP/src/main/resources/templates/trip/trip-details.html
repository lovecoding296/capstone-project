<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Chi tiết chuyến đi</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <h2>Chi tiết chuyến đi</h2>

    <div>
        <h3 id="trip-title"></h3>
        <p><strong>Thành phố:</strong> <span id="trip-city"></span></p>
        <p><strong>Thời gian:</strong> <span id="trip-start"></span> - <span id="trip-end"></span></p>

        <h3>Lịch Trình</h3>
        <div id="itinerary-container"></div>

        <p><strong>Mô tả chi tiết:</strong></p>
        <p id="trip-description"></p>

        <p><strong>Chi phí ước tính:</strong> <span id="trip-price"></span></p>

        <p><strong>Người tổ chức:</strong> 
            <a id="trip-creator-link"><span id="trip-creator-name"></span></a>
        </p>

        <p>Ngôn ngữ đã chọn: <span id="trip-languages"></span></p>

        <h3>Hình ảnh</h3>
        <div id="trip-images"></div>

        <a id="trip-review-link">Chuyến đi đã kết thúc, hãy để lại đánh giá.</a>
        <a id="trip-edit-link">Chỉnh sửa</a>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {			
			const pathSegments = window.location.pathname.split('/');
			const tripId = pathSegments[2]; // Phần tử thứ 2 là {id}
			console.log(tripId);


            if (!tripId) {
                alert("Không tìm thấy ID chuyến đi.");
                return;
            }

            axios.get(`/api/trips/${tripId}`)
                .then(response => {
                    const trip = response.data;

                    document.getElementById("trip-title").textContent = trip.title;
                    document.getElementById("trip-city").textContent = trip.city;
                    document.getElementById("trip-start").textContent = formatDateTime(trip.startDate);
                    document.getElementById("trip-end").textContent = formatDateTime(trip.endDate);
                    document.getElementById("trip-description").innerHTML = trip.description;
                    document.getElementById("trip-price").textContent = trip.price + " VND";

                    // Creator
                    const creatorLink = document.getElementById("trip-creator-link");
                    creatorLink.href = `/users/${trip.creator.id}`;
                    document.getElementById("trip-creator-name").textContent = trip.creator.fullName;

                    // Ngôn ngữ
                    document.getElementById("trip-languages").textContent = trip.languages.length > 0
                        ? trip.languages.join(", ")
                        : "Chưa chọn";

                    // Hình ảnh
                    const imageContainer = document.getElementById("trip-images");
                    trip.images.forEach(image => {
                        const imgElement = document.createElement("img");
                        imgElement.src = image.url;
                        imgElement.alt = "Trip Image";
                        imgElement.style = "width: 200px; height: 150px; margin: 5px;";
                        imageContainer.appendChild(imgElement);
                    });

                    // Lịch trình
                    const itineraryContainer = document.getElementById("itinerary-container");
                    trip.itineraries.forEach(itinerary => {
                        const itineraryDiv = document.createElement("div");
                        itineraryDiv.innerHTML = `
                            <h4>Ngày ${itinerary.dayNo}</h4>
                            ${itinerary.activities.map(activity => `
                                <p><strong>Tiêu đề:</strong> ${activity.title}</p>
                                <p><strong>Mô tả:</strong> ${activity.description}</p>
                            `).join("")}
                            <hr>
                        `;
                        itineraryContainer.appendChild(itineraryDiv);
                    });

                    // Links
                    document.getElementById("trip-review-link").href = `/reviews/trip/${trip.id}`;
                    document.getElementById("trip-edit-link").href = `/trips/${trip.id}/edit`;
                })
                .catch(error => {
                    console.error("Lỗi khi tải chuyến đi:", error);
                    alert("Không thể tải thông tin chuyến đi.");
                });

            function formatDateTime(dateTime) {
                const date = new Date(dateTime);
                return date.toLocaleDateString("vi-VN") + " " + date.toLocaleTimeString("vi-VN");
            }
        });
    </script>
</body>

</html>
