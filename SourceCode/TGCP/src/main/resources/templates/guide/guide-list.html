<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">





	<!-- Flatpickr CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
	<!-- Flatpickr JS -->
	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<!-- Bootstrap Bundle with Popper -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<link rel="stylesheet" th:href="@{/style.css}">
	<script th:src="@{/jquery-3.6.0.min.js}"></script>
	<script th:src="@{/app-script.js}"></script>





	<style>
		.pagination {
		    display: flex;
		    justify-content: center;
		    padding-left: 0;
		    list-style: none;
		    margin-top: 20px;
		    margin-bottom: 20px;
		}

		.pagination .page-item {
		    margin: 0 5px;
		}

		.user-card {
			background-color: #fff;
			border-radius: 16px;
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
			padding: 20px;
		}

		.user-avatar img {
			width: 100%;
			height: 200px;
			border-radius: 12px;
			object-fit: cover;
			display: block;
			margin-bottom: 10px;
		}

		.user-card h2 {
			font-size: 20px;
			margin: 0;
		}

		.user-card .rating {
			font-size: 14px;
			color: #888;
			margin: 4px 0;
		}

		.user-card .city {
			font-size: 14px;
			color: #555;
		}

		.user-card .buttons {
			display: flex;
			justify-content: center;
			gap: 10px;
		}

		.user-card button {
			padding: 8px 14px;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			font-size: 14px;
			color: #fff;
			transition: background-color 0.3s ease;
		}

		.btn-message {
			background-color: #007bff;
		}

		.btn-message:hover {
			background-color: #0056b3;
		}

		.btn-hire {
			background-color: #28a745;
		}

		.btn-hire:hover {
			background-color: #1e7e34;
		}
	</style>

</head>

<body>
	<nav th:replace="~{page-component :: header}"></nav>

	<div class="text-center page-title">
		<h4>Tìm kiếm hướng dẫn viên</h4>
	</div>

	<div class="container mt-4">
		<div class="row">

			<!-- Cột bên trái: Bộ lọc -->
			<div class="col-md-3 mb-4">
				<form method="get" action="/guides">
					<div class="p-3 border rounded shadow-sm">
						<h5 class="mb-3">Bộ lọc</h5>

						<!-- Thành phố -->
						<div class="mb-3">
							<label for="filterCity" class="form-label">Thành phố</label>
							<select id="filterCity" name="city" class="form-select">
								<option value="">Tất cả</option>
								<option th:each="c : ${cities}" th:value="${c}" th:text="${c.name()}"
									th:selected="${param.city != null && c.name() == param.city[0]}">
								</option>
							</select>



						</div>

						<!-- Ngôn ngữ -->
						<div class="mb-3">
							<label for="filterLanguage" class="form-label">Ngôn ngữ</label>
							<select id="filterLanguage" name="language" class="form-select">
								<option value="">Tất cả</option>
								<option th:each="lang : ${languages}" th:value="${lang.name()}" th:text="${lang}"
									th:selected="${param.language != null && lang.name() == param.language[0]}">
								</option>
							</select>
						</div>


						<div class="mb-3">
							<label for="filterPrice" class="form-label">Giá tối đa (VND/ngày)</label>
							<input type="number" id="filterPrice" name="maxPrice" class="form-control" min="0"
								placeholder="VD: 500000" th:value="${param.maxPrice}">
						</div>

						<div class="mb-3">
							<label for="filterGender" class="form-label">Giới tính</label>
							<select id="filterGender" name="gender" class="form-select">
								<option value="">Tất cả</option>
								<option value="MALE" th:selected="${param.gender != null && param.gender[0] == 'MALE'}">
									Nam</option>
								<option value="FEMALE"
									th:selected="${param.gender != null && param.gender[0] == 'FEMALE'}">Nữ</option>
							</select>
						</div>

						<div class="mb-3">
						    <label class="form-label">Loại giấy phép</label>
						    <div class="form-check">
						        <input class="form-check-input" type="checkbox" id="filterLocalGuide" name="localGuide"
						               th:checked="${param.localGuide != null}">
						        <label class="form-check-label" for="filterLocalGuide">
						            Hướng dẫn viên nội địa
						        </label>
						    </div>
						    <div class="form-check">
						        <input class="form-check-input" type="checkbox" id="filterInternationalGuide" name="internationalGuide"
						               th:checked="${param.internationalGuide != null}">
						        <label class="form-check-label" for="filterInternationalGuide">
						            Hướng dẫn viên quốc tế
						        </label>
						    </div>
						</div>



						<button type="submit" class="btn btn-primary w-100">Tìm kiếm</button>
					</div>
				</form>
			</div>


			<!-- Cột bên phải: Danh sách hướng dẫn viên -->
			<div class="col-md-9">
				<div class="row">
					<div class="col-md-4 mb-4" th:each="user : ${users}">
						<div class="user-card p-3 border rounded shadow-sm">
							<div class="user-avatar text-center mb-3">
								<a th:href="@{/users/{id}(id=${user.id})}">
									<img th:src="${user.avatarUrl}" th:alt="${user.fullName}" class="img-fluid rounded"
										style="height: 200px; object-fit: cover;">
								</a>
							</div>
							<h5 th:text="${user.fullName}" class="text-center">Tên người dùng</h5>

							<div class="rating text-center mb-2">
								⭐ <span th:text="${user.averageRating}">4.5</span> (<span
									th:text="${user.reviewCount}">100</span> đánh giá)
							</div>
							
							<div class="mb-2" style="height: 50px;">
								<span class="badge bg-info me-1" th:if="${user.isLocalGuide}">Hướng dẫn viên nội địa</span>
								<br th:if="${user.isLocalGuide and user.isInternationalGuide}" />
								<span class="badge bg-warning text-dark" th:if="${user.isInternationalGuide}">Hướng dẫn viên quốc tế</span>
							</div>


							<div class="city mb-2 d-flex align-items-center">
								<img src="images/icons/location-icon.webp" style="width: 16px; height: 16px;"
									class="me-2">
								<span th:text="${user.city}"></span>
							</div>

							<div class="languages mb-2 d-flex align-items-center">
								<img src="images/icons/language-icon.PNG" style="width: 16px; height: 16px;"
									class="me-2">
								<span th:text="${user.languages}"></span>
							</div>

							<div class="buttons d-flex justify-content-between mt-3">
								<button class="btn btn-primary btn-sm"
									th:attr="onclick=|openChatWithUser(${user.id}, '${user.fullName}')|">Gửi tin
									nhắn</button>

								<button class="btn btn-success btn-sm"
									th:attr="onclick=|openBookingPopup(${user.id}, '${user.fullName}', ${user.pricePerDay})|">Thuê</button>
							</div>
						</div>
					</div>
				</div> <!-- end row user list -->
					<div class="pagination">
						<ul class="pagination justify-content-center">
							<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled' : ''">
								<a class="page-link" th:href="@{/guides(page=0)}">Đầu</a>
							</li>
							<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled' : ''">
								<a class="page-link" th:href="@{/guides(page=${currentPage - 1})}">Trước</a>
							</li>

							<li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
								th:classappend="${i == currentPage} ? 'active' : ''">
								<a class="page-link" th:href="@{/guides(page=${i})}" th:text="${i + 1}"></a>
							</li>

							<li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled' : ''">
								<a class="page-link" th:href="@{/guides(page=${currentPage + 1})}">Sau</a>
							</li>
							<li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled' : ''">
								<a class="page-link" th:href="@{/guides(page=${totalPages - 1})}">Cuối</a>
							</li>
						</ul>
					</div>

			</div>
		</div>
	</div>











	<script th:src="@{/script/booking-popup.js}"></script>

	</div>
	</div>

	<footer th:replace="~{page-component :: footer}"></footer>

</body>

</html>