
	<nav th:fragment="header" id="main-nav"
		class="navbar navbar-expand-lg navbar-dark position-fixed top-0 start-0 w-100 z-3">
		<div class="container">
			<a class="navbar-brand" style="font-weight: bold;" href="/" th:text="#{logo}"></a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
				aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ms-auto">
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="languageDropdown" role="button"
							data-bs-toggle="dropdown" aria-expanded="false">
							<img id="selected-flag" th:src="@{'/images/icons/flags/' + ${#locale.language} + '.svg'}"
								style="height: 20px;">
							<span id="selected-language" th:text="${#locale.language.toUpperCase()}"></span>
						</a>
						<ul class="dropdown-menu" aria-labelledby="languageDropdown">
							<th:block th:with="languages=${'en,vi'.split(',')}">
								<li th:each="lang : ${languages}" th:if="${#locale.language != lang}">
									<a class="dropdown-item" th:attr="onclick='changeLanguage(\'' + ${lang} + '\')'"
										style="cursor: pointer;">
										<img th:src="@{'/images/icons/flags/' + ${lang} + '.svg'}"
											th:alt="${lang.toUpperCase()}" style="height: 20px;">
										<span th:text="${lang.toUpperCase()}"></span>
									</a>
								</li>
							</th:block>
						</ul>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="/guides" role="button">
							<span >T√¨m h∆∞·ªõng d·∫´n vi√™n</span>
						</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="/posts/new" role="button">
							<span th:text="#{post.create}">T·∫°o b√†i vi·∫øt m·ªõi</span>
						</a>
					</li>
					<li class="nav-item" >
						<a class="nav-link" href="/dashboard">
							Dashboard</a>
					</li>

					<li class="nav-item" sec:authorize="!isAnonymous()">
						<a class="nav-link" th:if="${session.loggedInUser.isAdmin()}" href="/manager-user/verify">
							Manage Verify Account</a>
					</li>
					
					<li class="nav-item dropdown" id="messageDropdown">
					  <a class="nav-link dropdown-toggle" href="#" id="messageLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
					
						<img src="/images/icons/message.png" style="
												    width: 30px;
												    height: 30px;
												">
					</a>
					  
					  <i class="bi bi-chat-dots"></i>
					    <span id="messageCountBadge" class="position-absolute badge rounded-pill bg-danger" style="transform: translateX(200%) translateY(-200%); display:none;">
					      0
					    </span>
					  <ul class="dropdown-menu" id="userList" style="max-height: 300px; overflow-y: auto; padding-left: 0; list-style: none;"></ul>

					</li>

					
					<script>
						
						function formatTimestamp(isoString) {
						  const date = new Date(isoString);
						  return date.toLocaleString('vi-VN', {
						    hour: '2-digit',
						    minute: '2-digit',
						    day: '2-digit',
						    month: '2-digit',
						    year: 'numeric'
						  });
						}

						
					  function loadAllReceivedMessage() {
					    return fetch(`/api/chat/last-messages`)
					      .then(response => {
					        if (!response.ok) {
					          throw new Error("kh√¥ng th·ªÉ l·∫•y tin nh·∫Øn");
					        }
					        return response.json();
					      });
					  }

					  // Khi click v√†o "Tin nh·∫Øn"
					  document.getElementById('messageLink').addEventListener('click', function () {
					    loadAllReceivedMessage().then(users => {
					      const userList = document.getElementById('userList');
					      userList.innerHTML = '';

					      users.forEach(user => {
					        const li = document.createElement('li');
					        li.innerHTML = `
					          <a class="dropdown-item d-flex align-items-start gap-2" href="#" data-userid="${user.partnerId}" data-username="${user.fullName}">
					            <img src="${user.avatarUrl || 'https://i.pravatar.cc/40?u=' + user.partnerId}" 
					                 alt="${user.fullName || 'Ng∆∞·ªùi d√πng'}" 
					                 class="rounded-circle" width="40" height="40">
					            <div>
					              <div><strong>${user.fullName || 'Kh√¥ng r√µ t√™n'}</strong></div>
					              <div class="text-muted small text-truncate" style="max-width: 220px;">
					                ${user.lastMessage}
					              </div>
					              <div class="text-muted small">${formatTimestamp(user.timestamp)}</div>
					            </div>
					          </a>
					        `;
					        userList.appendChild(li);

					        li.querySelector('a').addEventListener('click', (e) => {
					          e.preventDefault();
					          const partnerId = e.currentTarget.dataset.userid;
					          const partnerName = e.currentTarget.dataset.username;

					          console.log("data set " + partnerId);
					          openChatWithUser(partnerId, partnerName);
					        });
					      });
					    }).catch(err => {
					      console.error('L·ªói khi load tin nh·∫Øn:', err);
					    });
					  });

					  
					  
					</script>


					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
							data-bs-toggle="dropdown" aria-expanded="false">
							<svg th:replace="~{icons :: user}"></svg>
						</a>
						<ul sec:authorize="isAnonymous()" class="dropdown-menu" aria-labelledby="userDropdown"
							id="userPopup">
							<li>
								<a class="dropdown-item" href="/signup" th:text="#{signup}"></a>
							</li>
							<li>
								<a class="dropdown-item" href="/login" th:text="#{login}"></a>
							</li>
						</ul>
						<ul sec:authorize="!isAnonymous()" class="dropdown-menu" aria-labelledby="userDropdown"
							id="userPopup">
							<li>
								<a class="dropdown-item" th:href="@{/users/{id}(id=${session.loggedInUser.id})}"
									th:text="#{profile.page}">Trang c√° nh√¢n</a>
							</li>
							
							
							<li>
								<a class="dropdown-item" th:href="@{/posts/author/{id}(id=${session.loggedInUser.id})}"
									th:text="#{post.mine}">B√†i vi·∫øt c·ªßa t√¥i</a>
							</li>
							
							<li>
								<a class="dropdown-item" th:href="@{/reviews/{id}(id=${session.loggedInUser.id})}"
									th:text="#{review.mine}">ƒê√°nh gi√° c·ªßa t√¥i</a>
							</li>
							<li>
								<a class="dropdown-item"
									th:href="@{/reviews/reviewed/{id}(id=${session.loggedInUser.id})}"
									th:text="#{review.given}">ƒê√°nh gi√° ƒë√£ cho</a>
							</li>
							<li>
								<a class="dropdown-item" href="/logout">ƒêƒÉng xu·∫•t</a>
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</div>
		

		
		
		
	</nav>

	<footer th:fragment="footer" id="footer" class=".container-fluid">
		<div class="row">
			<div class="col-3">
				<h2 th:text="#{support}"></h2>
				<br><a class="text-start" href="#" th:text="#{FAQs}"></a>
				<br><a class="text-start" href="#" th:text="#{contactUs}"></a>
				<br><a class="text-start" href="#" th:text="#{supportUs}"></a>
			</div>
			<div class="col-3">
				<h2 th:text="#{aboutUs}"></h2>
				<br><a href="#">Blog</a>
			</div>

			<div class="col-12 text-center">
				<br><br><br>
				<br>

				<p>&copy; 2025 Tourism Guide Connection Platform Company. All rights reserved.</p>
				<div>
					<a href="#">Privacy Policy</a> |
					<a href="#">Terms of Service</a> |
					<a href="#">Contact</a>
				</div>
				<div class="social-icons">
					<a href="#">üîµ Facebook</a>
					<a href="#">üî∑ Twitter</a>
					<a href="#">üì∏ Instagram</a>
				</div>

			</div>
		</div>

	</footer>