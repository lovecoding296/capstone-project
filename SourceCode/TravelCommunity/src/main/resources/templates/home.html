<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!--<title th:text="#{logo}"></title>-->


	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<!-- Bootstrap Bundle with Popper -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<link rel="stylesheet" href="style.css">
	<script src="jquery-3.6.0.min.js"></script>
	<script src="app-script.js"></script>
	<style>



	</style>


</head>

<body>
	<nav th:replace="~{page-component :: header}"></nav>

	<h1>Danh s√°ch c√°c chuy·∫øn ƒëi</h1>
	<div class="container mt-4">
		<div class="row">
			<div th:each="trip : ${trips}" class="col-md-6">
				<div class="card mb-3">
					<div class="card-body">
						<h5 class="card-title" th:text="${trip.title}">Ti√™u ƒë·ªÅ</h5>
						<p class="card-text"><strong>ƒê·ªãa ƒëi·ªÉm:</strong> <span th:text="${trip.destination}">ƒê·ªãa
								ƒëi·ªÉm</span></p>
						<p class="card-text">
							<strong>Th·ªùi gian:</strong>
							<span th:text="${#temporals.format(trip.startDate, 'dd/MM/yyyy')}">Ng√†y b·∫Øt ƒë·∫ßu</span> -
							<span th:text="${#temporals.format(trip.endDate, 'dd/MM/yyyy')}">Ng√†y k·∫øt th√∫c</span>
						</p>
						<p class="card-text"><strong>Ng∆∞·ªùi t·ªï ch·ª©c:</strong> <span
								th:text="${trip.creator.fullName}">Ng∆∞·ªùi t·ªï ch·ª©c</span></p>
						<p class="card-text"><strong>S·ªë ng∆∞·ªùi tham gia:</strong> <span
								th:text="${#lists.size(trip.participants)}">0</span></p>
						<div class="d-flex justify-content-between">
							<a th:href="@{/trips/{id}/details(id=${trip.id})}" class="btn btn-info">Xem chi ti·∫øt</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	</table>

	<h1>Danh s√°ch b√†i vi·∫øt</h1>

	<div class="container mt-4">
		<div class="row">
			<div th:each="post : ${posts}" class="col-md-12">
				<div class="card mb-3">
					<div class="card-body">
						<h5 class="card-title" th:text="${post.title}">Ti√™u ƒë·ªÅ</h5>
						<p class="text-muted">
							<strong>Ng√†y ƒëƒÉng:</strong>
							<span th:text="${#temporals.format(post.createdAt, 'dd/MM/yyyy HH:mm')}">Ng√†y ƒëƒÉng</span>
						</p>
						<p><strong>T√°c gi·∫£:</strong> <span th:text="${post.author.fullName}">T√°c gi·∫£</span></p>
						<p><strong>N·ªôi dung:</strong> <span th:text="${post.content}">N·ªôi dung</span></p>

						<p>
							<strong>Th√≠ch:</strong>
							<span th:id="'like-count-' + ${post.id}"
								th:text="${post.likes != null ? post.likes.size() : 0}">0</span>
							|
							<strong>B√¨nh lu·∫≠n:</strong>
							<span th:text="${post.comments != null ? post.comments.size() : 0}">0</span>
						</p>

						<!-- N√∫t Th√≠ch -->
						<button class="btn btn-primary btn-sm" th:attr="onclick='toggleLike(' + ${post.id} + ')'">
							üëç Th√≠ch
						</button>
					</div>
				</div>

				<!-- Danh s√°ch b√¨nh lu·∫≠n -->
				<div class="card mb-3">
					<div class="card-body">
						<h6 class="card-title">B√¨nh lu·∫≠n:</h6>
						<button class="btn btn-primary" th:attr="onclick='loadComments(' + ${post.id} + ')'">Xem b√¨nh
							lu·∫≠n</button>
						<div th:id="'comment-section-' + ${post.id}" class="mt-3"></div>

						<!-- Form th√™m b√¨nh lu·∫≠n -->
						<form th:attr="onsubmit='addComment(event, ' + ${post.id} + ')'" class="mt-3">
							<input type="text" th:id="'comment-content-' + ${post.id}" class="form-control"
								placeholder="Nh·∫≠p b√¨nh lu·∫≠n..." required>
							<button type="submit" class="btn btn-success btn-sm mt-2">G·ª≠i</button>
						</form>
					</div>
				</div>
			</div>

			<script>
				function toggleLike(postId) {
					fetch(`/api/likes/${postId}`, {method: 'POST'})
						.then(response => response.json())
						.then(data => {
							document.getElementById(`like-count-${postId}`).innerText = data.likeCount;
						})
						.catch(error => console.error("L·ªói:", error));
				}

				function addComment(event, postId) {
					event.preventDefault();
					const content = document.getElementById(`comment-content-${postId}`).value;

					fetch(`/api/comments/post/${postId}`, {
						method: "POST",
						headers: {"Content-Type": "application/json"},
						body: JSON.stringify({content: content})
					})
						.then(response => response.json())
						.then(data => {
							//location.reload(); // Refresh trang ƒë·ªÉ th·∫•y comment m·ªõi
							console.log("data " + data)
							loadComments(postId)
						})
						.catch(error => console.error("L·ªói:", error));
				}
			</script>

			<script>
				function loadComments(postId) {
					fetch(`/api/comments/post/${postId}`)
						.then(response => response.json())
						.then(comments => {
							let commentSection = document.getElementById(`comment-section-${postId}`);
							commentSection.innerHTML = ""; // X√≥a n·ªôi dung c≈©

							comments.forEach(comment => {
								let commentHtml = `
				                        <div class="mb-2">
				                            <p><strong>${comment.commenter.fullName}</strong></p>
				                            <p>${comment.content}</p>
				                            <p class="text-muted">
				                                <small>${new Date(comment.createdAt).toLocaleString()}</small>
				                            </p>
				                            <hr>
				                        </div>
				                    `;
								commentSection.innerHTML += commentHtml;
							});
						})
						.catch(error => console.error("Error loading comments:", error));
				}
			</script>



		</div>
	</div>





	<footer th:replace="~{page-component :: footer}"></footer>




</body>

</html>